import { ExecutionError } from "../error.js";
import { createCapabilityContext } from "./context.js";
function createAutomationCapability(key, config) {
  return {
    _tag: "automation",
    key,
    config: {
      title: config.title,
      description: config.description
    },
    async handler(event) {
      try {
        const capabilityContext = createCapabilityContext();
        await config.execute(event, capabilityContext);
        process.stdout.write(
          `
<output>${JSON.stringify({ status: "success" })}</output>
`
        );
      } catch (err) {
        const error = new ExecutionError(err);
        process.stdout.write(
          `
<output>${JSON.stringify({ status: "error", error: { name: error.name, message: error.message } })}</output>
`
        );
        throw error;
      }
    }
  };
}
export {
  createAutomationCapability
};
